install.packages("remotes")
remotes::install_github("braverock/quantstrat")
install.packages("quantmod")
library(quantmod)
getSymbols("GGBR4.SA", from = "2013-04-15", to = "2018-10-30", src = "yahoo")
View(GGBR4.SA)
View(GGBR4.SA)
install.packages("TTR")
get_prices <- function(ticker, date_beg, date_end) {
getSymbols(ticker, from = date_beg, to = date_end, src = "yahoo")
}
get_prices("BRFS3.SA", "2015-01-01", "2016-12-31")
library(quantmod)
get_prices <- function(ticker, date_beg, date_end) {
getSymbols(ticker, from = date_beg, to = date_end, src = "yahoo")
}
get_prices("BRFS3.SA", "2015-01-01", "2016-12-31")
library(quantmod)
get_prices <- function(ticker, date_beg, date_end) {
df <- getSymbols(ticker, from = date_beg, to = date_end, src = "yahoo")
}
get_prices("BRFS3.SA", "2015-01-01", "2016-12-31")
library(quantmod)
get_prices <- function(ticker, date_beg, date_end) {
df <- getSymbols(ticker, from = date_beg, to = date_end, src = "yahoo")
}
get_prices("BRFS3.SA", "2015-01-01", "2016-12-31")
View(get_prices)
getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
View(BRFS3.SA)
get_prices("BRFS3.SA", "2015-01-01", "2016-12-31")
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
library(quantmod)
get_prices <- function(ticker, date_beg, date_end) {
getSymbols(ticker, from = date_beg, to = date_end, src = "yahoo")
}
brfs <- get_prices("BRFS3.SA", "2015-01-01", "2016-12-31")
View(BRFS3.SA)
library(quantmod)
get_prices <- function(ticker, date_beg, date_end) {
getSymbols(ticker, from = date_beg, to = date_end, src = "yahoo")
}
brfs <- get_prices("BRFS3.SA", "2015-01-01", "2016-12-31")
BRFS.sA
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
df <- getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
BRFS3.SA
View(BRFS3.SA)
library(quantmod)
get_prices <- function(ticker, date_beg, date_end) {
getSymbols(ticker, from = date_beg, to = date_end, src = "yahoo")
}
get_prices("BRFS3.SA", "2015-01-01", "2016-12-31")
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
BRFS3.SA
library(quantmod)
get_prices <- function(ticker, date_beg, date_end) {
getSymbols(ticker, from = date_beg, to = date_end, src = "yahoo", auto.assign = TRUE)
}
get_prices("BRFS3.SA", "2015-01-01", "2016-12-31")
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
# BRFS3.SA
library(quantmod)
get_prices <- function(ticker, date_beg, date_end) {
df <- getSymbols(ticker, from = date_beg, to = date_end, src = "yahoo", auto.assign = FALSE)
}
get_prices("BRFS3.SA", "2015-01-01", "2016-12-31")
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
# BRFS3.SA
BRFS3.SA
library(quantmod)
get_prices <- function(ticker, date_beg, date_end) {
getSymbols(ticker, from = date_beg, to = date_end, src = "yahoo", auto.assign = TRUE)
}
get_prices("BRFS3.SA", "2015-01-01", "2016-12-31")
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
BRFS3.SA
BRFS3.SA
library(quantmod)
get_prices <- function(ticker, date_beg, date_end) {
getSymbols(ticker, from = date_beg, to = date_end, src = "yahoo", env=globalenv())
}
get_prices("BRFS3.SA", "2015-01-01", "2016-12-31")
BRFS3.SA
?apply
library(quantmod)
get_prices <- function(ticker, date_beg, date_end) {
getSymbols(ticker, from = date_beg, to = date_end, src = "yahoo", env=globalenv())
}
stocks_list <- c("PETR4.SA", "GGBR4.SA", "SLCE3.SA")
# get_prices("BRFS3.SA", "2015-01-01", "2016-12-31")
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
lapply(stocks_list, get_prices, date_beg = "2015-01-01", date_end = "2016-12-31")
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
apply(stocks_list, get_prices, date_beg = "2015-01-01", date_end = "2016-12-31")
library(quantmod)
get_prices <- function(ticker, date_beg, date_end) {
getSymbols(ticker, from = date_beg, to = date_end, src = "yahoo", env=globalenv())
}
stocks_list <- c("PETR4.SA", "GGBR4.SA", "SLCE3.SA")
# get_prices("BRFS3.SA", "2015-01-01", "2016-12-31")
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
apply(stocks_list, get_prices, date_beg = "2015-01-01", date_end = "2016-12-31")
?apply
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
apply(stocks_list, 1, get_prices, date_beg = "2015-01-01", date_end = "2016-12-31")
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
apply(stocks_list, 2, get_prices, date_beg = "2015-01-01", date_end = "2016-12-31")
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
tapply(stocks_list, get_prices, date_beg = "2015-01-01", date_end = "2016-12-31")
# getSymbols("BRFS3.SA", from = "2015-01-01", to = "2016-12-31", src = "yahoo")
stock_prices <- lapply(stocks_list, get_prices, date_beg = "2015-01-01", date_end = "2016-12-31")
View(stock_prices)
lapply(stocks_list, get_prices, date_beg = "2015-01-01", date_end = "2016-12-31")
library(quantmod)
get_prices <- function(ticker, date_beg, date_end) {
getSymbols(ticker, from = date_beg, to = date_end, src = "yahoo", env=globalenv())
}
stocks_list <- c("^BVSP","PETR4.SA", "GGBR4.SA", "SLCE3.SA")
# get_prices("BRFS3.SA", "2015-01-01", "2016-12-31")
lapply(stocks_list, get_prices, date_beg = "2015-01-01", date_end = "2016-12-31")
View(BVSP)
run_tree <- function(dataf, msize = 500) {tree <- causalTree(cheater ~ student_gender, data = dataf, treatment = dataf$treatment,
split.Rule = "CT", cv.option = "CT", split.Honest = T, cv.Honest = T, split.Bucket = F,
xval = 5, cp = 0, minsize = msize, propensity = 0.5)
opcp <- tree$cptable[,1][which.min(tree$cptable[,4])]
opfit <- prune(tree, opcp)
rpart.plot(opfit)
}
library(foreign)
library(tidyverse)
library(causalTree)
setwd("~/BGSE/Economics Methods for Data Science/Final project/Data")
#read data
df <- read.dta("base_final_AEJ_publication.dta")
#count for how many years of data on each student
occurances <- df %>%
group_by(folio) %>%
summarize(count=n())
#separate all cheaters
cheaters <- df %>%
mutate(cheater = W001 + W0001 + W0001 + GBT001 + GBT0001 + GBT00001) %>%
filter(cheater != 0) %>%
distinct(folio, .keep_all = TRUE) %>%
select(folio, cheater)
#clean data for relevant information only
df_n <- df %>%
left_join(occurances, by = 'folio') %>%
left_join(cheaters, by = 'folio') %>%
filter(count == 3) %>%
select(c('cheater', 'treatment', 'folio', 'ali_score', 'student_gender', 'age', 'studies_mother', 'studies_father', 'fam_income', 'fam_members', 'internet', 'scholarship', 'num_books', 'ali_stdscore', 'mat_score'))
#treat -9 and binary code for treatment and control group
df_n[df_n==-9]<-NA
df_n$treatment[df_n$treatment == 'C'] <- 0
# df1$treatment[df1$treatment != 0] <- 1
df_n$cheater[df_n$cheater > 0] <- 1
df_n$cheater[is.na(df_n$cheater)] <- 0
# create a df for each treatment
df1 <- filter(df_n, treatment == 0 | treatment == 'T1')
df1$treatment[df1$treatment == 'T1'] <- 1
df1$treatment <- as.integer(df1$treatment)
df2 <- filter(df_n, treatment == 0 | treatment == 'T2')
df2$treatment[df2$treatment == 'T2'] <- 1
df2$treatment <- as.integer(df2$treatment)
df3 <- filter(df_n, treatment == 0 | treatment == 'T3')
df3$treatment[df3$treatment == 'T3'] <- 1
df3$treatment <- as.integer(df3$treatment)
run_tree <- function(dataf, msize = 500) {tree <- causalTree(cheater ~ student_gender, data = dataf, treatment = dataf$treatment,
split.Rule = "CT", cv.option = "CT", split.Honest = T, cv.Honest = T, split.Bucket = F,
xval = 5, cp = 0, minsize = msize, propensity = 0.5)
opcp <- tree$cptable[,1][which.min(tree$cptable[,4])]
opfit <- prune(tree, opcp)
rpart.plot(opfit)
}
run_tree(df1,200)
dev.copy(png,'myplot.png')
dev.off()
run_tree(df2,200)
run_tree(df3,200)
View(df3)
run_tree(df1,200)
run_tree(df2,200)
run_tree(df3,200)
run_tree <- function(dataf, msize = 500) {tree <- causalTree(cheater ~ scholarship , data = dataf, treatment = dataf$treatment,
split.Rule = "CT", cv.option = "CT", split.Honest = T, cv.Honest = T, split.Bucket = F,
xval = 5, cp = 0, minsize = msize, propensity = 0.5)
opcp <- tree$cptable[,1][which.min(tree$cptable[,4])]
opfit <- prune(tree, opcp)
rpart.plot(opfit)
}
run_tree(df1,200)
run_tree(df2,200)
run_tree(df3,200)
run_tree <- function(dataf, msize = 500) {tree <- causalTree(cheater ~ internet , data = dataf, treatment = dataf$treatment,
split.Rule = "CT", cv.option = "CT", split.Honest = T, cv.Honest = T, split.Bucket = F,
xval = 5, cp = 0, minsize = msize, propensity = 0.5)
opcp <- tree$cptable[,1][which.min(tree$cptable[,4])]
opfit <- prune(tree, opcp)
rpart.plot(opfit)
}
run_tree(df1,200)
run_tree(df2,200)
run_tree(df3,200)
run_tree <- function(dataf, msize = 500) {tree <- causalTree(cheater ~ studies_father , data = dataf, treatment = dataf$treatment,
split.Rule = "CT", cv.option = "CT", split.Honest = T, cv.Honest = T, split.Bucket = F,
xval = 5, cp = 0, minsize = msize, propensity = 0.5)
opcp <- tree$cptable[,1][which.min(tree$cptable[,4])]
opfit <- prune(tree, opcp)
rpart.plot(opfit)
}
run_tree(df1,200)
run_tree(df2,200)
run_tree(df3,200)
dev.copy(png,'myplot.png')
dev.off()
contador <- 1
dev.copy(png, file=sprintf("%s.plot.jpg",contador))
contador <- contador +1
dev.off()
dev.copy(png, file=sprintf("plot_%s.png",contador))
contador <- contador +1
dev.off()
?paste
run_tree <- function(dataf, msize = 500) {tree <- causalTree(cheater ~ student_gender , data = dataf, treatment = dataf$treatment,
split.Rule = "CT", cv.option = "CT", split.Honest = T, cv.Honest = T, split.Bucket = F,
xval = 5, cp = 0, minsize = msize, propensity = 0.5)
opcp <- tree$cptable[,1][which.min(tree$cptable[,4])]
opfit <- prune(tree, opcp)
rpart.plot(opfit)
}
cc <- 1
run_tree(df1,200)
contador <- paste('gender', cc, sep = "")
dev.copy(png, file=sprintf("plot_%s.png",contador))
cc <- cc +1
dev.off()
run_tree(df2,200)
contador <- paste('gender', cc, sep = "")
dev.copy(png, file=sprintf("plot_%s.png",contador))
cc <- cc +1
dev.off()
run_tree(df3,200)
contador <- paste('gender', cc, sep = "")
dev.copy(png, file=sprintf("plot_%s.png",contador))
cc <- cc +1
dev.off()
run_tree <- function(dataf, msize = 500) {tree <- causalTree(cheater ~ scholarship , data = dataf, treatment = dataf$treatment,
split.Rule = "CT", cv.option = "CT", split.Honest = T, cv.Honest = T, split.Bucket = F,
xval = 5, cp = 0, minsize = msize, propensity = 0.5)
opcp <- tree$cptable[,1][which.min(tree$cptable[,4])]
opfit <- prune(tree, opcp)
rpart.plot(opfit)
}
cc <- 1
run_tree(df1,200)
contador <- paste('scholarship', cc, sep = "")
dev.copy(png, file=sprintf("plot_%s.png",contador))
cc <- cc +1
dev.off()
run_tree(df2,200)
contador <- paste('scholarship', cc, sep = "")
dev.copy(png, file=sprintf("plot_%s.png",contador))
cc <- cc +1
dev.off()
run_tree(df3,200)
contador <- paste('scholarship', cc, sep = "")
dev.copy(png, file=sprintf("plot_%s.png",contador))
cc <- cc +1
dev.off()
run_tree <- function(dataf, msize = 500) {tree <- causalTree(cheater ~ scholarship , data = dataf, treatment = dataf$treatment,
split.Rule = "CT", cv.option = "CT", split.Honest = T, cv.Honest = T, split.Bucket = F,
xval = 5, cp = 0, minsize = msize, propensity = 0.5)
opcp <- tree$cptable[,1][which.min(tree$cptable[,4])]
opfit <- prune(tree, opcp)
rpart.plot(opfit)
}
cc <- 1
run_tree(df1,200)
run_tree <- function(dataf, msize = 500) {tree <- causalTree(cheater ~ age , data = dataf, treatment = dataf$treatment,
split.Rule = "CT", cv.option = "CT", split.Honest = T, cv.Honest = T, split.Bucket = F,
xval = 5, cp = 0, minsize = msize, propensity = 0.5)
opcp <- tree$cptable[,1][which.min(tree$cptable[,4])]
opfit <- prune(tree, opcp)
rpart.plot(opfit)
}
cc <- 1
run_tree(df1,200)
contador <- paste('age', cc, sep = "")
dev.copy(png, file=sprintf("plot_%s.png",contador))
cc <- cc +1
dev.off()
run_tree(df2,200)
contador <- paste('age', cc, sep = "")
dev.copy(png, file=sprintf("plot_%s.png",contador))
cc <- cc +1
dev.off()
run_tree(df3,200)
contador <- paste('age', cc, sep = "")
dev.copy(png, file=sprintf("plot_%s.png",contador))
cc <- cc +1
dev.off()
run_tree(df1,200)
library(foreign)
library(tidyverse)
library(causalTree)
setwd("~/BGSE/Economics Methods for Data Science/Final project/Data")
#read data
df <- read.dta("base_final_AEJ_publication.dta")
#count for how many years of data on each student
occurances <- df %>%
group_by(folio) %>%
summarize(count=n())
#separate all cheaters
cheaters <- df %>%
mutate(cheater = W001 + W0001 + W0001 + GBT001 + GBT0001 + GBT00001) %>%
filter(cheater != 0) %>%
distinct(folio, .keep_all = TRUE) %>%
select(folio, cheater)
#clean data for relevant information only
df_n <- df %>%
left_join(occurances, by = 'folio') %>%
left_join(cheaters, by = 'folio') %>%
filter(count == 3) %>%
select(c('cheater', 'treatment', 'folio', 'ali_score', 'student_gender', 'age', 'studies_mother', 'studies_father', 'fam_income', 'fam_members', 'internet', 'scholarship', 'num_books', 'ali_stdscore', 'mat_score'))
#treat -9 and binary code for treatment and control group
df_n[df_n==-9]<-NA
df_n$treatment[df_n$treatment == 'C'] <- 0
# df1$treatment[df1$treatment != 0] <- 1
df_n$cheater[df_n$cheater > 0] <- 1
df_n$cheater[is.na(df_n$cheater)] <- 0
# create a df for each treatment
df1 <- filter(df_n, treatment == 0 | treatment == 'T1')
df1$treatment[df1$treatment == 'T1'] <- 1
df1$treatment <- as.integer(df1$treatment)
df2 <- filter(df_n, treatment == 0 | treatment == 'T2')
df2$treatment[df2$treatment == 'T2'] <- 1
df2$treatment <- as.integer(df2$treatment)
df3 <- filter(df_n, treatment == 0 | treatment == 'T3')
df3$treatment[df3$treatment == 'T3'] <- 1
df3$treatment <- as.integer(df3$treatment)
run_tree <- function(dataf, msize = 500) {tree <- causalTree(cheater ~ age , data = dataf, treatment = dataf$treatment,
split.Rule = "CT", cv.option = "CT", split.Honest = T, cv.Honest = T, split.Bucket = F,
xval = 5, cp = 0, minsize = msize, propensity = 0.5)
opcp <- tree$cptable[,1][which.min(tree$cptable[,4])]
opfit <- prune(tree, opcp)
rpart.plot(opfit)
}
run_tree(df1,200)
